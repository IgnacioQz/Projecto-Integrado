{% extends "base.html" %}

{% block title %}Listado de Calificaciones - NUAM{% endblock %}

{% block main %}
<div class="container py-4">
  <!-- Header con t√≠tulo y botones de acci√≥n -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="m-0">üìã Calificaciones Tributarias</h2>
    <div>
      <a class="btn btn-outline-secondary me-2" href="{% url 'sandbox' %}">
        ‚Üê Volver al Sandbox
      </a>
      <a class="btn btn-primary" href="{% url 'carga_manual' %}">
        ‚ûï Nueva Calificaci√≥n
      </a>
    </div>
  </div>

  <!-- Mensajes de sistema (success, error, info) -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <!-- Tabla de calificaciones -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-striped align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-3">ID</th>
              <th>Ejercicio</th>
              <th>Mercado</th>
              <th>Instrumento</th>
              <th>Secuencia</th>
              <th>ISFUT</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for it in items %}
              <tr>
                <td class="ps-3 fw-bold">{{ it.calificacion_id }}</td>
                <td>{{ it.ejercicio }}</td>
                <td>
                  <span class="badge bg-secondary">{{ it.mercado }}</span>
                </td>
                <td>{{ it.instrumento.nombre }}</td>
                <td>{{ it.secuencia_evento }}</td>
                <td>
                  {% if it.isfut %}
                    <span class="badge bg-success">S√≠</span>
                  {% else %}
                    <span class="badge bg-light text-dark">No</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  <a class="btn btn-sm btn-outline-primary" 
                     href="{% url 'calificacion_edit' it.pk %}"
                     title="Editar montos y factores">
                    ‚úèÔ∏è Editar
                  </a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted py-5">
                  <div class="mb-2">üì≠</div>
                  <p class="mb-1">No hay calificaciones registradas</p>
                  <small>Haz clic en "Nueva Calificaci√≥n" para comenzar</small>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Footer con contador -->
    {% if items %}
      <div class="card-footer text-muted small">
        Mostrando {{ items|length }} calificaci√≥n{{ items|length|pluralize:"es" }}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}