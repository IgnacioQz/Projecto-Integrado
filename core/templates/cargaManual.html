{% extends 'base.html' %}
{% load static %}

{% block title %}
    Ingresar Calificación - NUAM
{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'css/cargaManual.css' %}">
{% endblock %}

{% block main %}
    <div class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>➕ Ingresar Nueva Calificación Tributaria</h2>
            </div>

            <div class="modal-body">
                {% if messages %}
                    {% for m in messages %}
                        <div class="alert alert-{{ m.tags }} mb-3">{{ m }}</div>
                    {% endfor %}
                {% endif %}

                <form method="post" novalidate>
                    {% csrf_token %}

                    <fieldset class="border p-3 mb-3 rounded">
                        <legend class="float-none w-auto px-2">Datos de la calificación</legend>
                        <div class="row">
                            {% for field in form %}
                                <div class="col-md-4 mb-2">
                                    <label class="form-label">{{ field.label }}{% if field.field.required %} *{% endif %}</label>
                                    {{ field }}
                                    <div class="text-danger small">{{ field.errors }}</div>
                                </div>
                            {% endfor %}
                        </div>
                    </fieldset>

                    <fieldset class="border p-3 rounded">
                        <legend class="float-none w-auto px-2">Factores (posiciones 8..37)</legend>
                        <table class="table table-sm">
                            <thead><tr><th>Posición</th><th>Valor (0..1)</th></tr></thead>
                            <tbody>
                                {% for f in formset %}
                                    <tr>
                                        <td>{{ f.posicion }}</td>
                                        <td>{{ f.valor }}</td>
                                    </tr>
                                    {% if f.errors %}
                                        <tr><td colspan="2" class="text-danger small">{{ f.errors }}</td></tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </fieldset>
                </form>
            </div>

            <div class="modal-footer">
                <a href="{% url 'main' %}" class="btn-modal btn-secondary">✕ Cancelar</a>
                <button class="btn-modal btn-primary">✓ OK - Continuar</button>
            </div>
        </div>
    </div>
{% endblock %}